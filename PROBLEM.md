

Надо написать http сервер WebFlux c двумя методами:


curl -X POST -d '1234' http://localhost:8080/accumulate

curl -X GET  http://localhost:8080/calculate


Вместо 1234 может быть любое число (long).


Сервер реализует следующий функционал:


Вызов метод /accumulate блокируется (с точки зрения вызывающего) до того момента пока кто-то не вызовет метод /calculate. Одновременно может “висеть” много таких открытых /accumulate соединений.


Когда кто-то вызывает метод /calculate - все “висящие” /accumulate удачно разрешаются и возвращают сумму аргументов из всех “висящих” к данному моменту соединений.


/calculate должен вернуть ту же сумму, после того как удачно завершится отправка результатов всем запросившим /accumulate.


Все запросы, пришедшие после очередного запроса /calculate, должны ждать следующего вызова /calculate.



Пример работы:


В терминале 1:
curl -X POST -d '1 http://localhost:8080/accumulate
(блокировка)


В терминале 2:
curl -X POST -d '2' http://localhost:8080/accumulate
(блокировка)

В терминале 3:
curl -X POST -d '3' http://localhost:8080/accumulate
(блокировка)

В терминале 4:
curl -X GET  http://localhost:8080/calculate
ответ: 6

ответ 6 приходит в этот момент во всех остальных терминалах.